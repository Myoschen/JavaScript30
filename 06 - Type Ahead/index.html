<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Type Ahead ðŸ‘€</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <form class="search-form">
      <input type="text" class="search" placeholder="City or State" />
      <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
      </ul>
    </form>
    <script>
      {
        const searchInput = document.querySelector(".search");
        const suggestions = document.querySelector(".suggestions");

        // å–å¾—é é¢åŽŸæœ¬æ‰€é¡¯ç¤º htmlã€‚
        const defaultHtml = suggestions.innerHTML;

        const endpoint =
          "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";

        const locations = [];

        // é€éŽ fetch å¾ž API ç²å– dataï¼Œä¸¦å°‡å–å¾—çš„è³‡æ–™æ”¾ç½® locationsã€‚
        fetch(endpoint)
          .then((res) => res.json())
          .then((data) => {
            const mappedData = data.map((loc) => ({
              city: loc.city,
              state: loc.state,
              population: loc.population,
            }));
            locations.push(...mappedData);
          });

        // console.log(locations);

        // ä¿®æ”¹ population å‘ˆç¾æ–¹å¼
        function numberWithCommas(num) {
          const regex = new RegExp(/\B(?=(\d{3})+(?!\d))/g);
          return num.replace(regex, ",");
        }

        // å°‡ç¬¦åˆ searchInput çš„è³‡æ–™é¡¯ç¤ºæ–¼é é¢ä¸Šã€‚
        function displayMatches(e) {
          // é€éŽæ­£è¦è¡¨é”å¼ä¾†å°‹æ‰¾ç¬¦åˆçš„è³‡æ–™ã€‚
          // ç¯©é¸æ¢ä»¶ç‚º giï¼šå…¨æ–‡åŠä¸å€åˆ†å¤§å°å¯«ã€‚
          const input = e.target.value;
          const regex = new RegExp(input, "gi");
          const matches = locations.filter(
            ({ city, state }) => city.match(regex) || state.match(regex)
          );

          // è½‰ç‚º html æ ¼å¼ã€‚
          const html = matches
            .map(({ city, state, population }) => {
              const cityName = city.replace(
                regex,
                `<span class="hl">${input}</span>`
              );
              const stateName = state.replace(
                regex,
                `<span class="hl">${input}</span>`
              );
              return `
              <li>
                <span class="name">${cityName}, ${stateName}</span>
                <span class="population">${numberWithCommas(population)}</span>
              </li>
            `;
            })
            .join("");
          suggestions.innerHTML = input.length > 0 ? html : defaultHtml;
        }

        searchInput.addEventListener("input", displayMatches);
      }
    </script>
  </body>
</html>
